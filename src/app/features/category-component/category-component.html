<!-- Filter and Search -->
<div class="flex justify-between items-center p-4">
  <!-- Filter -->
  <div class="flex items-center gap-5">
    <label class="text-lg mx-5" for="filterSelect"
      >Filter Category by Name:</label
    >
    <select
      id="filterSelect"
      class="border-2 rounded-sm p-1"
      [(ngModel)]="filterByName"
      (ngModelChange)="onFilterChange()"
    >
      <option value="">All Categories</option>
      <option *ngFor="let name of names" [value]="name">{{ name }}</option>
    </select>
  </div>

  <!-- Search -->
  <div class="flex items-center mr-5">
    <label class="text-lg mx-3" for="searchInput">Search by Name:</label>
    <input
      id="searchInput"
      type="text"
      class="border-2 rounded-sm p-1"
      [(ngModel)]="searchByName"
      (ngModelChange)="onSearchChange()"
      placeholder="Search categories..."
    />
  </div>

  <!-- Add New Category -->
  <div class="flex mr-5">
    <button
      class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
      (click)="showAddCategoryRow()"
    >
      Add New Category
    </button>
  </div>
</div>

<!-- Category Table -->
<div class="p-6 overflow-x-auto">
  <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-50">
      <tr>
        <th
          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"
        >
          ID
        </th>
        <th
          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"
        >
          Category Image
        </th>
        <th
          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"
        >
          Category Name
        </th>
        <th
          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"
        >
          Created At
        </th>
        <th
          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"
        >
          Updated At
        </th>
        <th
          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"
        >
          Actions
        </th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
      <!-- Add New Row -->
      <tr *ngIf="newCategoryRowVisible" class="bg-yellow-50">
        <td class="px-6 py-4">—</td>
        <td class="px-6 py-4">
          <input
            type="text"
            [(ngModel)]="newCategory.image"
            class="border-2 rounded-sm px-2 py-1 text-sm w-full"
            placeholder="Image URL"
            name="newImage"
          />
        </td>
        <td class="px-6 py-4">
          <input
            type="text"
            [(ngModel)]="newCategory.name"
            class="border-2 rounded-sm px-2 py-1 text-sm w-full"
            placeholder="Category Name"
            name="newName"
          />
        </td>

        <td class="px-6 py-4 text-gray-400">—</td>
        <td class="px-6 py-4 text-gray-400">—</td>
        <td class="px-6 py-4 flex gap-2">
          <button
            class="bg-green-500 text-white px-3 py-1 rounded text-sm"
            (click)="addCategory()"
            [disabled]="!newCategory.name"
          >
            Save
          </button>
          <button
            class="bg-gray-500 text-white px-3 py-1 rounded text-sm"
            (click)="cancelNewCategory()"
          >
            Cancel
          </button>
        </td>
      </tr>

      <!-- Loading State -->
      <tr *ngIf="loading">
        <td colspan="7" class="text-center py-6 text-sm text-gray-500">
          Loading categories...
        </td>
      </tr>

      <!-- Error State -->
      <tr *ngIf="error">
        <td colspan="7" class="text-center py-6 text-sm text-red-500">
          {{ error }}
        </td>
      </tr>

      <!-- Empty State -->
      <tr *ngIf="!loading && !error && filteredCategories.length === 0">
        <td colspan="7" class="text-center py-6 text-sm text-gray-500">
          No Categories Available
        </td>
      </tr>

      <!-- Category Rows -->
      <tr *ngFor="let category of filteredCategories">
        <td class="px-6 py-4 whitespace-nowrap">
          <div class="text-sm text-gray-900">{{ category._id }}</div>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <img
            *ngIf="editingCategoryId !== category._id"
            [src]="category.image || 'assets/placeholder.png'"
            alt="Category Image"
            class="w-16 h-16 object-cover rounded"
          />
          <input
            *ngIf="editingCategoryId === category._id"
            type="text"
            class="border-2 rounded-sm px-2 py-1 text-sm w-full"
            [(ngModel)]="categoryProps.image"
            name="editImage"
            placeholder="Image URL"
          />
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <div
            *ngIf="editingCategoryId !== category._id"
            class="text-sm text-gray-900"
          >
            {{ category.name }}
          </div>
          <input
            *ngIf="editingCategoryId === category._id"
            type="text"
            class="border-2 rounded-sm px-2 py-1 text-sm w-full"
            [(ngModel)]="categoryProps.name"
            name="editName"
            required
            placeholder="Category Name"
          />
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <div class="text-sm text-gray-900">
            {{ category.createdAt | date: 'medium' }}
          </div>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <div class="text-sm text-gray-900">
            {{ category.updatedAt | date: 'medium' }}
          </div>
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
          <button
            *ngIf="editingCategoryId !== category._id"
            class="text-blue-600 hover:text-blue-900 mr-2"
            (click)="startEdit(category)"
          >
            Update
          </button>
          <button
            *ngIf="editingCategoryId === category._id"
            class="text-green-600 hover:text-green-900 mr-2"
            (click)="updateCategory()"
            [disabled]="!categoryProps.name"
          >
            Save
          </button>
          <button
            *ngIf="editingCategoryId === category._id"
            class="text-gray-600 hover:text-gray-900 mr-2"
            (click)="cancelEdit()"
          >
            Cancel
          </button>
          <button
            class="text-red-600 hover:text-red-900"
            (click)="category._id && deleteCategory(category._id)"
          >
            Delete
          </button>
        </td>
      </tr>
    </tbody>
  </table>
  <div class="flex justify-center items-center gap-4 mt-6">
    <button
      class="px-4 py-2 bg-gray-200 rounded disabled:opacity-50"
      (click)="previousPage()"
      [disabled]="currentPage === 1"
    >
      Previous
    </button>

    <span class="text-gray-700 text-sm font-medium">
      Page {{ currentPage }}
    </span>

    <button
      class="px-4 py-2 bg-gray-200 rounded disabled:opacity-50"
      (click)="nextPage()"
      [disabled]="!canPaginate()"
    >
      Next
    </button>
  </div>
</div>
