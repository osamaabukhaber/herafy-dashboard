<!-- Professional Payment Details - Desktop Optimized with Tailwind -->
<div class="min-h-screen bg-gradient-to-br from-slate-50 via-gray-50/50 to-blue-50/30 py-8">
  
  <!-- Main Container -->
  <div class="max-w-7xl mx-auto px-6 lg:px-8">
    
    <!-- Header Section -->
    <div class="bg-white/95 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/60 mb-8 overflow-hidden">
      <!-- Header Background -->
      <div class="bg-gradient-to-r from-slate-800 via-slate-700 to-blue-900 p-8">
        <div class="flex flex-col xl:flex-row xl:items-center xl:justify-between gap-6">
          <div class="flex items-center space-x-6">
            <!-- Company Logo -->
            <div class="w-16 h-16 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center shadow-lg">
              <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
              </svg>
            </div>
            <div class="text-white">
              <h1 class="text-3xl xl:text-4xl font-bold mb-2">Payment Management</h1>
              <p class="text-white/80 text-lg">Administrative Dashboard</p>
            </div>
          </div>
          
          <!-- Navigation Controls -->
          <div class="flex items-center space-x-4 bg-white/10 backdrop-blur-sm rounded-2xl p-4">
            <div class="text-white/80 text-sm font-medium mr-4">
              {{ currentIndex + 1 }} of {{ paymentAllIds.length }}
            </div>
            <button 
              (click)="previousPayment()"
              [disabled]="currentIndex === 0"
              class="flex items-center px-6 py-3 bg-white/20 hover:bg-white/30 disabled:bg-white/10 disabled:opacity-50 text-white rounded-xl transition-all duration-300 disabled:cursor-not-allowed transform hover:scale-105">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
              Previous
            </button>
            <button 
              (click)="nextPayment()"
              [disabled]="currentIndex === paymentAllIds.length - 1"
              class="flex items-center px-6 py-3 bg-white/90 hover:bg-white text-slate-800 hover:text-slate-900 rounded-xl transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed font-medium transform hover:scale-105 shadow-lg">
              Next
              <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>
      
      <!-- Transaction Info Bar -->
      <div class="bg-white/95 p-6 border-b border-slate-100">
        <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-6">
          <div class="flex flex-col sm:flex-row sm:items-center space-y-4 sm:space-y-0 sm:space-x-8">
            <div class="flex items-center space-x-3">
              <span class="text-slate-600 font-semibold">Transaction ID:</span>
              <code class="px-4 py-2 bg-slate-100 text-slate-800 rounded-lg font-mono text-sm border shadow-sm">
                {{ payment?.transactionId }}
              </code>
            </div>
            <div class="flex items-center space-x-3">
              <span class="text-slate-600 font-semibold">Date:</span>
              <span class="px-4 py-2 bg-blue-50 text-blue-800 rounded-lg text-sm font-medium border border-blue-200">
                {{ payment?.createdAt | date:'MMM dd, yyyy - h:mm a' }}
              </span>
            </div>
          </div>
          
          <!-- Status Badge -->
          <div 
            class="px-6 py-3 rounded-xl font-bold text-sm uppercase tracking-wider shadow-lg self-start"
            [ngClass]="{
              'bg-emerald-100 text-emerald-800 border border-emerald-200': payment?.status === 'completed',
              'bg-amber-100 text-amber-800 border border-amber-200': payment?.status === 'pending',
              'bg-red-100 text-red-800 border border-red-200': payment?.status === 'failed' || payment?.status === 'refunded'
            }">
            <div class="flex items-center space-x-2">
              <div class="w-2 h-2 rounded-full" 
                  [ngClass]="{
                    'bg-emerald-500': payment?.status === 'completed',
                    'bg-amber-500': payment?.status === 'pending',
                    'bg-red-500': payment?.status === 'failed' || payment?.status === 'refunded'
                  }"></div>
              <span>{{ payment?.status | titlecase }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 xl:grid-cols-12 gap-8">
      
      <!-- Left Column - Payment & Order Details -->
      <div class="xl:col-span-8 space-y-8">
        
        <!-- Payment Overview Card -->
        <div class="bg-white/95 backdrop-blur-xl rounded-3xl shadow-xl border border-white/60 p-8 hover:shadow-2xl transition-all duration-300">
          <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-8 gap-4">
            <h2 class="text-2xl font-bold text-slate-800 flex items-center">
              <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl mr-4 flex items-center justify-center shadow-lg">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                </svg>
              </div>
              Payment Overview
            </h2>
            <span class="text-sm text-slate-500 bg-slate-50 px-4 py-2 rounded-lg font-medium border">
              {{ payment?.provider | titlecase }}
            </span>
          </div>
          
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Amount Breakdown -->
            <div class="space-y-6">
              <div class="p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl border border-blue-100 shadow-sm">
                <div class="text-sm font-semibold text-slate-600 mb-2">Total Amount</div>
                <div class="text-4xl font-bold text-blue-600 mb-4">
                  ${{ payment?.amount | number:'1.2-2' }}
                </div>
                
                <!-- Breakdown Details -->
                <div class="space-y-3 text-sm">
                  <div class="flex justify-between items-center py-2 border-b border-blue-100">
                    <span class="text-slate-600">Subtotal:</span>
                    <span class="font-semibold text-slate-800">${{ payment?.order?.subtotal | number:'1.2-2' }}</span>
                  </div>
                  <div class="flex justify-between items-center py-2 border-b border-blue-100">
                    <span class="text-slate-600">Tax:</span>
                    <span class="font-semibold text-slate-800">${{ payment?.order?.tax | number:'1.2-2' }}</span>
                  </div>
                  <div class="flex justify-between items-center py-2 border-b border-blue-100">
                    <span class="text-slate-600">Shipping:</span>
                    <span class="font-semibold text-slate-800">${{ payment?.order?.shippingFee | number:'1.2-2' }}</span>
                  </div>
                  <div class="border-t-2 border-blue-200 pt-3 flex justify-between items-center">
                    <span class="font-bold text-slate-800">Total:</span>
                    <span class="font-bold text-xl text-blue-600">${{ payment?.order?.totalAmount | number:'1.2-2' }}</span>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Payment Method Details -->
            <div class="space-y-6">
              <div class="p-6 bg-slate-50 rounded-2xl border border-slate-200 shadow-sm">
                <div class="text-sm font-semibold text-slate-600 mb-4">Payment Method</div>
                
                <div class="flex items-center space-x-4 mb-6">
                  <div class="w-12 h-12 bg-white rounded-xl border-2 border-slate-200 flex items-center justify-center shadow-sm">
                    <img 
                      aria-label="payment provider logo"
                      [src]="payment?.provider + '-logo.png'" 
                      [alt]="payment?.provider"
                      class="w-8 h-6 object-contain">
                  </div>
                  <div>
                    <div class="font-bold text-slate-800 text-lg">{{ payment?.provider | titlecase }}</div>
                    <div class="text-sm text-slate-600">{{ payment?.paymentMethod?.replace('_', ' ') | titlecase }}</div>
                  </div>
                </div>
                
                <!-- Transaction Details -->
                <div class="space-y-3 text-sm">
                  <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2">
                    <span class="text-slate-600 font-medium">Transaction ID:</span>
                    <code class="font-mono text-xs bg-slate-100 px-3 py-2 rounded border break-all">
                      {{ payment?.transactionId }}
                    </code>
                  </div>
                  <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2" *ngIf="payment?.stripeSessionId">
                    <span class="text-slate-600 font-medium">Session ID:</span>
                    <code class="font-mono text-xs bg-slate-100 px-3 py-2 rounded border break-all">
                      {{ payment?.stripeSessionId }}
                    </code>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Enhanced Order Status Timeline -->
        <div class="bg-white/95 backdrop-blur-xl rounded-3xl shadow-xl border border-white/60 p-8 hover:shadow-2xl transition-all duration-300">
          <h3 class="text-2xl font-bold text-slate-800 flex items-center mb-8">
            <div class="w-10 h-10 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-xl mr-4 flex items-center justify-center shadow-lg">
              <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            Order Progress Timeline
          </h3>
          
          <!-- Professional Timeline -->
          <div class="relative mb-8">
            <!-- Progress Line -->
            <div class="absolute top-16 left-0 right-0 h-2 bg-slate-200 rounded-full"></div>
            <div class="absolute top-16 left-0 h-2 bg-gradient-to-r from-emerald-400 via-blue-400 to-purple-400 rounded-full transition-all duration-1000"
                  [style.width]="getProgressWidth()"></div>
            
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-8 relative z-10">
              <!-- Order Placed -->
              <div class="text-center">
                <div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-emerald-400 to-emerald-500 flex items-center justify-center shadow-xl relative transform hover:scale-105 transition-transform">
                  <svg class="w-7 h-7 text-white" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                  </svg>
                  <div class="absolute -inset-2 rounded-2xl bg-emerald-400/20 animate-pulse"></div>
                </div>
                <h4 class="font-bold text-slate-800 mb-2 text-sm lg:text-base">Order Placed</h4>
                <p class="text-xs lg:text-sm text-slate-600">{{ payment?.createdAt | date:'MMM dd, yyyy' }}</p>
                <p class="text-xs text-slate-500 mt-1">{{ payment?.createdAt | date:'h:mm a' }}</p>
              </div>
              
              <!-- Payment Processed -->
              <div class="text-center">
                <div 
                  class="w-16 h-16 mx-auto mb-4 rounded-2xl flex items-center justify-center shadow-xl relative transition-all duration-500 transform hover:scale-105"
                  [ngClass]="payment?.order?.paidAt ? 
                    'bg-gradient-to-br from-blue-400 to-blue-500' : 
                    'bg-gradient-to-br from-slate-300 to-slate-400'">
                  <svg class="w-7 h-7" [ngClass]="payment?.order?.paidAt ? 'text-white' : 'text-slate-600'" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4zM18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z"></path>
                  </svg>
                  <div *ngIf="payment?.order?.paidAt" class="absolute -inset-2 rounded-2xl bg-blue-400/20 animate-pulse"></div>
                </div>
                <h4 class="font-bold mb-2 text-sm lg:text-base" [ngClass]="payment?.order?.paidAt ? 'text-slate-800' : 'text-slate-500'">Payment</h4>
                <p class="text-xs lg:text-sm" [ngClass]="payment?.order?.paidAt ? 'text-slate-600' : 'text-slate-400'">
                  {{ payment?.order?.paidAt ? (payment?.order?.paidAt | date:'MMM dd, yyyy') : 'Pending' }}
                </p>
                <p class="text-xs text-slate-500 mt-1" *ngIf="payment?.order?.paidAt">
                  {{ payment?.order?.paidAt | date:'h:mm a' }}
                </p>
              </div>
              
              <!-- Order Shipped -->
              <div class="text-center">
                <div 
                  class="w-16 h-16 mx-auto mb-4 rounded-2xl flex items-center justify-center shadow-xl relative transition-all duration-500 transform hover:scale-105"
                  [ngClass]="payment?.order?.shippedAt ? 
                    'bg-gradient-to-br from-orange-400 to-orange-500' : 
                    'bg-gradient-to-br from-slate-300 to-slate-400'">
                  <svg class="w-7 h-7" [ngClass]="payment?.order?.shippedAt ? 'text-white' : 'text-slate-600'" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
                  </svg>
                  <div *ngIf="payment?.order?.shippedAt" class="absolute -inset-2 rounded-2xl bg-orange-400/20 animate-pulse"></div>
                </div>
                <h4 class="font-bold mb-2 text-sm lg:text-base" [ngClass]="payment?.order?.shippedAt ? 'text-slate-800' : 'text-slate-500'">Shipped</h4>
                <p class="text-xs lg:text-sm" [ngClass]="payment?.order?.shippedAt ? 'text-slate-600' : 'text-slate-400'">
                  {{ payment?.order?.shippedAt ? (payment?.order?.shippedAt | date:'MMM dd, yyyy') : 'Pending' }}
                </p>
                <p class="text-xs text-slate-500 mt-1" *ngIf="payment?.order?.shippedAt">
                  {{ payment?.order?.shippedAt | date:'h:mm a' }}
                </p>
              </div>
              
              <!-- Order Delivered -->
              <div class="text-center">
                <div 
                  class="w-16 h-16 mx-auto mb-4 rounded-2xl flex items-center justify-center shadow-xl relative transition-all duration-500 transform hover:scale-105"
                  [ngClass]="payment?.order?.deliveredAt ? 
                    'bg-gradient-to-br from-purple-400 to-purple-500' : 
                    'bg-gradient-to-br from-slate-300 to-slate-400'">
                  <svg class="w-7 h-7" [ngClass]="payment?.order?.deliveredAt ? 'text-white' : 'text-slate-600'" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                  </svg>
                  <div *ngIf="payment?.order?.deliveredAt" class="absolute -inset-2 rounded-2xl bg-purple-400/20 animate-pulse"></div>
                </div>
                <h4 class="font-bold mb-2 text-sm lg:text-base" [ngClass]="payment?.order?.deliveredAt ? 'text-slate-800' : 'text-slate-500'">Delivered</h4>
                <p class="text-xs lg:text-sm" [ngClass]="payment?.order?.deliveredAt ? 'text-slate-600' : 'text-slate-400'">
                  {{ payment?.order?.deliveredAt ? (payment?.order?.deliveredAt | date:'MMM dd, yyyy') : 'Pending' }}
                </p>
                <p class="text-xs text-slate-500 mt-1" *ngIf="payment?.order?.deliveredAt">
                  {{ payment?.order?.deliveredAt | date:'h:mm a' }}
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Order Items -->
        <div class="bg-white/95 backdrop-blur-xl rounded-3xl shadow-xl border border-white/60 p-8 hover:shadow-2xl transition-all duration-300" 
             *ngIf="payment?.order?.orderItems && (payment?.order?.orderItems?.length ?? 0) > 0">
          <h3 class="text-2xl font-bold text-slate-800 flex items-center mb-8">
            <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-xl mr-4 flex items-center justify-center shadow-lg">
              <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
              </svg>
            </div>
            Order Items ({{ payment?.order?.orderItems?.length }})
          </h3>
          
          <!-- Desktop Table View -->
          <div class="hidden lg:block overflow-x-auto">
            <table class="w-full">
              <thead>
                <tr class="border-b-2 border-slate-200">
                  <th class="text-left py-4 px-6 font-semibold text-slate-700">Item</th>
                  <th class="text-center py-4 px-6 font-semibold text-slate-700">Quantity</th>
                  <th class="text-right py-4 px-6 font-semibold text-slate-700">Unit Price</th>
                  <th class="text-right py-4 px-6 font-semibold text-slate-700">Total</th>
                </tr>
              </thead>
              <tbody>
                <tr 
                  *ngFor="let item of payment?.order?.orderItems; trackBy: trackByItemId"
                  class="border-b border-slate-100 hover:bg-slate-50/50 transition-colors">
                  <td class="py-4 px-6">
                    <div class="flex items-center space-x-4">
                      <div class="w-12 h-12 bg-slate-100 rounded-xl border flex items-center justify-center">
                        <svg class="w-6 h-6 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                        </svg>
                      </div>
                      <div>
                        <div class="font-semibold text-slate-800">{{ item.name || 'Product Item' }}</div>
                        <div class="text-sm text-slate-500" *ngIf="item.product">
                          ID: {{ item.product | slice:0:12 }}...
                        </div>
                      </div>
                    </div>
                  </td>
                  <td class="py-4 px-6 text-center">
                    <span class="inline-flex items-center px-3 py-1 bg-slate-100 text-slate-700 rounded-full text-sm font-medium">
                      {{ item.quantity || 1 }}
                    </span>
                  </td>
                  <td class="py-4 px-6 text-right font-semibold text-slate-800">
                    ${{ item.price || 0 | number:'1.2-2' }}
                  </td>
                  <td class="py-4 px-6 text-right">
                    <div class="font-bold text-lg text-slate-800">
                      ${{ (item.price || 0) * (item.quantity || 1) | number:'1.2-2' }}
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- Mobile Card View -->
          <div class="lg:hidden space-y-4">
            <div 
              *ngFor="let item of payment?.order?.orderItems; trackBy: trackByItemId"
              class="p-4 bg-slate-50 rounded-2xl border border-slate-200 hover:bg-white hover:shadow-md transition-all duration-300">
              <div class="flex items-center justify-between mb-3">
                <div class="flex items-center space-x-3">
                  <div class="w-10 h-10 bg-white rounded-xl border flex items-center justify-center shadow-sm">
                    <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                    </svg>
                  </div>
                  <div>
                    <div class="font-semibold text-slate-800">{{ item.name || 'Product Item' }}</div>
                    <div class="text-xs text-slate-500">Qty: {{ item.quantity || 1 }}</div>
                  </div>
                </div>
                <div class="text-right">
                  <div class="font-bold text-lg text-slate-800">
                    ${{ (item.price || 0) * (item.quantity || 1) | number:'1.2-2' }}
                  </div>
                  <div class="text-sm text-slate-500">
                    ${{ item.price || 0 | number:'1.2-2' }} each
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Enhanced Payment Details Right Column -->
<div class="xl:col-span-4 space-y-6">
  
  <!-- Customer Information Card -->
  <div class="group bg-white/95 backdrop-blur-xl rounded-3xl shadow-lg border border-white/60 p-8 
              hover:shadow-2xl hover:shadow-purple-100/50 transition-all duration-500 transform hover:-translate-y-1
              opacity-100 animate-[slideInRight_0.6s_ease-out_0.1s_forwards]">
    
    <!-- Header with Icon -->
    <div class="flex items-center justify-between mb-6">
      <h3 class="text-xl font-bold text-slate-800 flex items-center">
        <div class="w-10 h-10 bg-gradient-to-br from-purple-500 via-purple-600 to-indigo-600 
                    rounded-2xl mr-4 flex items-center justify-center shadow-lg 
                    group-hover:shadow-purple-300/50 transition-all duration-300 
                    group-hover:scale-110 group-hover:rotate-3">
          <svg class="w-5 h-5 text-white transition-transform duration-300 group-hover:scale-110" 
               fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
        </div>
        Customer Details
      </h3>
      
      <!-- Action Button -->
      <button
      aria-label="Refresh Timeline"
      class="opacity-100 group-hover:opacity-100 transition-all duration-300 
              bg-purple-50 hover:bg-purple-100 p-2 rounded-xl hover:scale-110">
        <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
        </svg>
      </button>
    </div>

    <!-- Customer Profile Card -->
    <div class="relative p-6 bg-gradient-to-br from-slate-50 via-white to-purple-50/40 
                rounded-3xl border border-slate-200/60 shadow-inner
                hover:shadow-md transition-all duration-300 group/profile">
      
      <!-- Profile Section -->
      <div class="flex items-center space-x-5 mb-4">
        <div class="relative">
          <!-- Avatar -->
          <div class="w-20 h-20 bg-gradient-to-br from-purple-400 via-purple-500 to-indigo-500 
                      rounded-3xl flex items-center justify-center shadow-lg 
                      transition-all duration-300 group-hover/profile:scale-105 
                      group-hover/profile:shadow-purple-300/50">
            <span class="text-white font-bold text-2xl tracking-wide">
              {{ payment?.user?.userName?.charAt(0)?.toUpperCase() }}
            </span>
          </div>
          
          <!-- Status Badge -->
          <div class="absolute -bottom-2 -right-2 w-7 h-7 bg-emerald-400 rounded-2xl 
                      border-3 border-white flex items-center justify-center shadow-lg
                      animate-pulse hover:animate-none transition-all duration-300">
            <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" 
                    d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" 
                    clip-rule="evenodd"></path>
            </svg>
          </div>
        </div>
        
        <!-- User Info -->
        <div class="flex-1 min-w-0">
          <div class="font-bold text-slate-800 text-xl truncate">{{ payment?.user?.userName }}</div>
          <div class="text-purple-600 font-medium text-sm truncate">{{ payment?.user?.email }}</div>
          <div class="flex items-center mt-2 text-xs text-emerald-600 font-semibold">
            <div class="w-2 h-2 bg-emerald-400 rounded-full mr-2 animate-pulse"></div>
            Verified Customer
          </div>
        </div>
      </div>
      
      <!-- User Details Grid -->
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-6">
        <div class="p-4 bg-white/80 rounded-2xl border border-slate-200/60 
                    hover:bg-white hover:shadow-sm transition-all duration-300 group/card">
          <div class="text-slate-600 font-semibold text-xs uppercase tracking-wider mb-2">User ID</div>
          <div class="relative">
            <code class="text-sm text-slate-700 font-mono bg-slate-100 px-2 py-1 rounded-lg">
              {{ payment?.user?._id | slice:0:12 }}...
            </code>
            <button
            aria-label="Copy User ID"
             class="absolute right-0 top-1 opacity-100 group-hover/card:opacity-100 
                           transition-all duration-200 hover:scale-110 p-1">
              <svg class="w-3 h-3 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                      d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
              </svg>
            </button>
          </div>
        </div>
        
        <div class="p-4 bg-white/80 rounded-2xl border border-slate-200/60 
                    hover:bg-white hover:shadow-sm transition-all duration-300">
          <div class="text-slate-600 font-semibold text-xs uppercase tracking-wider mb-2">Account Status</div>
          <div class="flex items-center">
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold 
                         bg-emerald-100 text-emerald-700 border border-emerald-200">
              <div class="w-2 h-2 bg-emerald-500 rounded-full mr-2 animate-pulse"></div>
              Active
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Shipping Address Card -->
  <div class="group bg-white/95 backdrop-blur-xl rounded-3xl shadow-lg border border-white/60 p-8 
              hover:shadow-2xl hover:shadow-orange-100/50 transition-all duration-500 transform hover:-translate-y-1
              opacity-100 animate-[slideInRight_0.6s_ease-out_0.2s_forwards]"
       *ngIf="payment?.order?.shippingAddress">
    
    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
      <h3 class="text-xl font-bold text-slate-800 flex items-center">
        <div class="w-10 h-10 bg-gradient-to-br from-orange-500 via-orange-600 to-red-500 
                    rounded-2xl mr-4 flex items-center justify-center shadow-lg 
                    group-hover:shadow-orange-300/50 transition-all duration-300 
                    group-hover:scale-110 group-hover:rotate-3">
          <svg class="w-5 h-5 text-white transition-transform duration-300 group-hover:scale-110" 
               fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
          </svg>
        </div>
        Shipping Address
      </h3>
      
      <!-- Map Button -->
      <button 
      aria-label="View on Map"
      class="opacity-100 group-hover:opacity-100 transition-all duration-300 
                     bg-orange-50 hover:bg-orange-100 p-2 rounded-xl hover:scale-110
                     hover:shadow-lg transform">
        <svg class="w-4 h-4 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path>
        </svg>
      </button>
    </div>
    
    <!-- Address Details -->
    <div class="relative p-6 bg-gradient-to-br from-slate-50 via-white to-orange-50/40 
                rounded-3xl border border-slate-200/60 shadow-inner group/address
                hover:shadow-md transition-all duration-300">
      
      <!-- Address Lines -->
      <div class="space-y-3 mb-6">
        <div class="flex items-start space-x-3">
          <div class="w-2 h-2 bg-orange-400 rounded-full mt-2 flex-shrink-0"></div>
          <div class="font-semibold text-slate-800 text-lg leading-tight">
            {{ payment?.order?.shippingAddress?.street }}
          </div>
        </div>
        
        <div class="flex items-start space-x-3">
          <div class="w-2 h-2 bg-orange-300 rounded-full mt-2 flex-shrink-0"></div>
          <div class="text-slate-600 font-medium">
            {{ payment?.order?.shippingAddress?.city }}, {{ payment?.order?.shippingAddress?.postalCode }}
          </div>
        </div>
        
        <div class="flex items-start space-x-3">
          <div class="w-2 h-2 bg-orange-200 rounded-full mt-2 flex-shrink-0"></div>
          <div class="text-slate-600 font-medium">
            {{ payment?.order?.shippingAddress?.country }}
          </div>
        </div>
      </div>
      
      <!-- Verification Badge -->
      <div class="flex items-center justify-between pt-4 border-t border-slate-200/60">
        <div class="flex items-center text-sm text-emerald-600 font-semibold">
          <div class="w-5 h-5 bg-emerald-100 rounded-full flex items-center justify-center mr-3">
            <svg class="w-3 h-3 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </div>
          Address verified for delivery
        </div>
        
        <!-- Track Button -->
        <button class="opacity-100 group-hover/address:opacity-100 transition-all duration-300 
                       px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white text-xs font-bold 
                       rounded-xl hover:scale-105 transform shadow-lg hover:shadow-orange-200">
          Track Package
        </button>
      </div>
    </div>
  </div>

  <!-- Activity Timeline Card -->
  <div class="group bg-white/95 backdrop-blur-xl rounded-3xl shadow-lg border border-white/60 p-8 
              hover:shadow-2xl hover:shadow-indigo-100/50 transition-all duration-500 transform hover:-translate-y-1
              opacity-100 animate-[slideInRight_0.6s_ease-out_0.3s_forwards]">
    
    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
      <h3 class="text-xl font-bold text-slate-800 flex items-center">
        <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 via-indigo-600 to-purple-600 
                    rounded-2xl mr-4 flex items-center justify-center shadow-lg 
                    group-hover:shadow-indigo-300/50 transition-all duration-300 
                    group-hover:scale-110 group-hover:rotate-3">
          <svg class="w-5 h-5 text-white transition-transform duration-300 group-hover:scale-110" 
               fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
        </div>
        Activity Timeline
      </h3>
      
      <!-- Refresh Button -->
      <button 
      aria-label="Refresh Timeline"
      class="opacity-100 group-hover:opacity-100 transition-all duration-300 
            bg-indigo-50 hover:bg-indigo-100 p-2 rounded-xl hover:scale-110 hover:rotate-180 
            transform">
        <svg class="w-4 h-4 text-indigo-600 transition-transform duration-300" 
             fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
        </svg>
      </button>
    </div>
    
    <!-- Timeline Container -->
    <div class="relative">
      <!-- Timeline Line -->
      <div class="absolute left-6 top-0 bottom-0 w-0.5 bg-gradient-to-b from-blue-200 via-orange-200 to-red-200"></div>
      
      <div class="space-y-6">
        <!-- Payment Created -->
        <div class="flex items-start space-x-5 group/timeline-item opacity-100 animate-[fadeInLeft_0.5s_ease-out_0.4s_forwards] hover:translate-x-1 transition-transform duration-300">
          <div class="relative z-10">
            <div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-500 rounded-2xl 
                        flex items-center justify-center shadow-lg group-hover/timeline-item:scale-110 
                        transition-all duration-300 group-hover/timeline-item:shadow-blue-300/50">
              <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                      d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
              </svg>
            </div>
            <div class="absolute -inset-1 bg-blue-100 rounded-2xl opacity-100 group-hover/timeline-item:opacity-50 
                        transition-opacity duration-300 -z-10"></div>
          </div>
          
          <div class="flex-1 bg-blue-50/50 rounded-2xl p-5 border border-blue-100 
                      group-hover/timeline-item:bg-blue-50 group-hover/timeline-item:shadow-md 
                      transition-all duration-300">
            <div class="flex items-center justify-between mb-2">
              <div class="font-bold text-slate-800 text-lg">Payment Created</div>
              <div class="text-xs text-slate-500 bg-white/80 px-3 py-1.5 rounded-xl font-medium 
                          shadow-sm border border-slate-200">
                {{ payment?.createdAt | date:'MMM d, y' }}
              </div>
            </div>
            <div class="text-slate-600 mb-2">Payment initiated and recorded in system</div>
            <div class="text-xs text-slate-500 font-medium">{{ payment?.createdAt | date:'h:mm a' }}</div>
          </div>
        </div>
        
        <!-- Status Updated -->
        <div class="flex items-start space-x-5 group/timeline-item opacity-100 animate-[fadeInLeft_0.5s_ease-out_0.5s_forwards] hover:translate-x-1 transition-transform duration-300"
             *ngIf="payment?.updatedAt !== payment?.createdAt">
          <div class="relative z-10">
            <div class="w-12 h-12 bg-gradient-to-br from-orange-400 to-orange-500 rounded-2xl 
                        flex items-center justify-center shadow-lg group-hover/timeline-item:scale-110 
                        transition-all duration-300 group-hover/timeline-item:shadow-orange-300/50">
              <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                      d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <div class="absolute -inset-1 bg-orange-100 rounded-2xl opacity-100 group-hover/timeline-item:opacity-50 
                        transition-opacity duration-300 -z-10"></div>
          </div>
          
          <div class="flex-1 bg-orange-50/50 rounded-2xl p-5 border border-orange-100 
                      group-hover/timeline-item:bg-orange-50 group-hover/timeline-item:shadow-md 
                      transition-all duration-300">
            <div class="flex items-center justify-between mb-2">
              <div class="font-bold text-slate-800 text-lg">Status Updated</div>
              <div class="text-xs text-slate-500 bg-white/80 px-3 py-1.5 rounded-xl font-medium 
                          shadow-sm border border-slate-200">
                {{ payment?.updatedAt | date:'MMM d, y' }}
              </div>
            </div>
            <div class="text-slate-600 mb-2">
              Payment status changed to 
              <span class="font-semibold text-orange-600">{{ payment?.status }}</span>
            </div>
            <div class="text-xs text-slate-500 font-medium">{{ payment?.updatedAt | date:'h:mm a' }}</div>
          </div>
        </div>
        
        <!-- Refunded -->
        <div class="flex items-start space-x-5 group/timeline-item opacity-100 animate-[fadeInLeft_0.5s_ease-out_0.6s_forwards] hover:translate-x-1 transition-transform duration-300"
             *ngIf="payment?.refundedAt">
          <div class="relative z-10">
            <div class="w-12 h-12 bg-gradient-to-br from-red-400 to-red-500 rounded-2xl 
                        flex items-center justify-center shadow-lg group-hover/timeline-item:scale-110 
                        transition-all duration-300 group-hover/timeline-item:shadow-red-300/50">
              <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                      d="M16 15v-1a4 4 0 00-4-4H8m0 0l3 3m-3-3l3-3m9 14V5a2 2 0 00-2-2H6a2 2 0 00-2 2v16l4-2 4 2 4-2 4 2z"></path>
              </svg>
            </div>
            <div class="absolute -inset-1 bg-red-100 rounded-2xl opacity-100 group-hover/timeline-item:opacity-50 
                        transition-opacity duration-300 -z-10"></div>
          </div>
          
          <div class="flex-1 bg-red-50/50 rounded-2xl p-5 border border-red-100 
                      group-hover/timeline-item:bg-red-50 group-hover/timeline-item:shadow-md 
                      transition-all duration-300">
            <div class="flex items-center justify-between mb-2">
              <div class="font-bold text-slate-800 text-lg">Payment Refunded</div>
              <div class="text-xs text-slate-500 bg-white/80 px-3 py-1.5 rounded-xl font-medium 
                          shadow-sm border border-slate-200">
                {{ payment?.refundedAt | date:'MMM d, y' }}
              </div>
            </div>
            <div class="text-slate-600 mb-2">Full refund processed successfully</div>
            <div class="text-xs text-slate-500 font-medium">{{ payment?.refundedAt | date:'h:mm a' }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Enhanced Loading State -->
<div *ngIf="!payment" 
    class="fixed inset-0 bg-gradient-to-br from-slate-50 via-blue-50/30 to-indigo-50/20 
            backdrop-blur-sm flex items-center justify-center z-50">
  <div class="text-center animate-[fadeIn_0.8s_ease-out_forwards]">
    <!-- Animated Loading Icon -->
    <div class="relative mb-8">
      <div class="w-24 h-24 border-4 border-slate-200 rounded-full animate-spin border-t-blue-500"></div>
      <div class="absolute inset-0 w-24 h-24 border-4 border-transparent rounded-full animate-[spin_1.5s_linear_infinite] animate-delay-500 border-r-indigo-400"></div>
      <div class="absolute inset-2 w-20 h-20 border-4 border-transparent rounded-full animate-[spin_2s_linear_infinite] animate-delay-1000 border-l-purple-400"></div>
    </div>
    
    <!-- Loading Text -->
    <div class="space-y-4">
      <h2 class="text-3xl font-bold bg-gradient-to-r from-slate-700 via-blue-600 to-indigo-600 
                bg-clip-text text-transparent animate-pulse">
        Loading Payment Details
      </h2>
      <p class="text-slate-600 animate-pulse text-lg">
        Please wait while we fetch the information...
      </p>
    </div>
    
    <!-- Loading Animation Dots -->
    <div class="mt-8 flex justify-center space-x-2">
      <div class="w-3 h-3 bg-blue-400 rounded-full animate-bounce"></div>
      <div class="w-3 h-3 bg-indigo-400 rounded-full animate-bounce" style="animation-delay: 0.1s;"></div>
      <div class="w-3 h-3 bg-purple-400 rounded-full animate-bounce" style="animation-delay: 0.2s;"></div>
      <div class="w-3 h-3 bg-pink-400 rounded-full animate-bounce" style="animation-delay: 0.3s;"></div>
    </div>
    
    <!-- Progress Bar -->
    <div class="mt-8 w-64 bg-slate-200 rounded-full h-2 mx-auto overflow-hidden">
      <div class="bg-gradient-to-r from-blue-500 to-indigo-500 h-full rounded-full 
                  animate-pulse" style="width: 60%;"></div>
    </div>
  </div>
</div>